---

# Architecture of Expense Tracker API

This document outlines the overall architecture and structure of the Expense Tracker API, explaining the design decisions, technologies used, and the flow of data.

## Overview

The Expense Tracker API is a backend system designed to handle user authentication, expense management, and notification functionalities. The system follows a **modular architecture** with clearly defined components for ease of scalability and maintainability. The project is built using **Flask**, **SQLAlchemy**, and **JWT** for authentication.

---

## Components

### 1. **Flask Application**
   - The core of the application is built using **Flask**, which handles HTTP requests and responses. The app is structured into **blueprints** for organizing routes and views.
   - Key modules include:
     - `routes.py`: Contains all the API routes related to user management, expense operations, and notification handling.
     - `models.py`: Defines the database schema using SQLAlchemy ORM.
     - `utils.py`: Utility functions such as password verification, notification creation, and recurring expense management.

### 2. **Database Layer**
   - The application uses **SQLAlchemy ORM** to interact with an **SQLite** database (for development). 
   - The following models are defined:
     - `User`: Manages user details such as username, email, and hashed password.
     - `Expenses`: Tracks individual expense entries including amount, description, and date.
     - `RecurringExpense`: Manages expenses that recur on a daily, weekly, or monthly basis.
     - `Notification`: Handles notifications generated by large expenses or other events.

### 3. **JWT Authentication**
   - **JWT (JSON Web Tokens)** is used to manage user authentication and authorization.
   - Upon successful login, the server generates a JWT, which the client includes in the headers for accessing protected routes.
   - Key protected routes include:
     - `/add_expense`
     - `/mod_expense`
     - `/filter_expenses`
     - `/notifications`
   - The **blacklist** system is used to invalidate JWT tokens when a user logs out.

### 4. **Error Handling and Logging**
   - The API includes comprehensive error handling to catch and manage exceptions such as invalid input, database integrity violations, and authentication failures.
   - **Logging** is implemented using Python's `logging` module to record error messages and warnings, which are stored in `app.log`.

---

## Data Flow

### 1. **User Registration and Authentication**
   - **Register**: A user provides their username, email, and password, which are validated and securely stored in the database.
   - **Login**: Users are authenticated by their email and password, and a JWT token is generated upon successful login.
   - **JWT Authentication**: Protected routes are accessible only if a valid JWT token is provided.

### 2. **Expense Management**
   - **Add Expense**: Users submit expense data (amount, description, date, category). The data is validated and inserted into the `Expenses` table.
   - **Modify/Delete Expense**: Users can update or remove their existing expenses. The app checks for valid user permissions and ensures the data is consistent.

### 3. **Recurring Expenses**
   - The system uses a background scheduler to automatically generate new recurring expense entries based on the specified recurrence (daily, weekly, monthly).

### 4. **Notifications**
   - **Notification Creation**: Notifications are generated when certain events occur (e.g., when a large expense is added).
   - **View/Manage Notifications**: Users can view their notifications, mark them as read, or delete them.

---

## Technologies Used

- **Flask**: A lightweight Python web framework used to build the API.
- **SQLAlchemy**: ORM for database interaction.
- **JWT**: Used for secure user authentication.
- **SQLite**: A lightweight database used in development. It can be replaced with PostgreSQL or MySQL in production.
- **FPDF**: Library used to export expense data to PDF format.
- **csv**: Python’s built-in CSV library for exporting data to CSV format.

---

## Folder Structure

```
├── app/
│   ├── __init__.py        # Initializes the Flask app and modules
│   ├── models.py          # SQLAlchemy models for User, Expenses, Notifications, etc.
│   ├── routes.py          # Flask routes (API endpoints)
│   ├── utils.py           # Utility functions (password verification, notifications)
├── migrations/            # Database migrations
├── tests/                 # Unit tests
├── docs/                  # Documentation (API documentation, model documentation)
│   ├── Api_documentation.md
│   ├── Model_documentation.md
├── .env                   # Environment variables
├── config.py              # Application configurations
├── README.md              # Instructions for setup and usage
└── requirements.txt       # Python dependencies
```

---

## Conclusion

The modular design of the Expense Tracker API ensures that the code is maintainable and scalable. Each component is designed to handle specific functionality, promoting separation of concerns. The architecture allows for easy future enhancements such as support for additional notification types, advanced filtering, and more robust authentication mechanisms.

---